# `feature-fetch`
> Status: Experimental

A straightforward, typesafe, and feature-based fetch wrapper.

- **Lightweight & Tree Shakable**: Function-based and modular design
- **Fast**: Thin wrapper around the native fetch, maintaining near-native performance
- **Modular & Expandable**: Easily extendable with features like `withRetry()`, ..
- **Typesafe**: Built in TypeScript with support for `openapi-typescript` types
- **Standalone**: Only dependent on `fetch`, making it usable in sandboxed environments like Figma plugin

### Motivation

Provide a typesafe, straightforward, and lightweight `fetch` wrapper that seamlessly integrates with OpenAPI schemas using `openapi-typescript`. It aims to simplify error handling by returning results in a predictable manner with [`ts-results-es`](https://github.com/lune-climate/ts-results-es#readme). Additionally, it is designed to be modular & expandable, enabling the creation of straightforward API wrappers, such as for the Google Web Fonts API (see `google-webfonts-client`), with simple and intuitive functions. `feature-fetch` only depends on `fetch`, making it usable in sandboxed environments like Figma plugins.

### Alternatives

- [wretch](https://github.com/elbywan/wretch)
- [openapi-fetch](https://github.com/drwpow/openapi-typescript/tree/main/packages/openapi-fetch)

# ðŸ“– Usage

## `withApi()`

A typesafe fetch wrapper.

```ts
import { createApiFetchClient } from 'feature-fetch';

const fetchClient = createApiFetchClient({
  prefixUrl: 'https://api.example.com/v1'
});

const result = await fetchClient.get<{ id: string }>('/blogposts/{postId}', {
  pathParams: {
    postId: '123'
  }
});

// 2XX Response Codes
if (result.isOk()) {
  console.log(result.value.data);
}
// Error response or Network exception
else {
  console.log(result.error);
}

// Or get OK response and throw error
result.unwrap();

await fetchClient.put('/blogposts/', { id: '123', message: 'hello' });
```

## `withOpenApi()`

A typesafe fetch wrapper that pulls in your OpenAPI schema using [`openapi-typescript`](https://github.com/drwpow/openapi-typescript/tree/main).

```ts
import { createOpenApiFetchClient } from 'feature-fetch';
// Generated by 'openapi-typescript'
import { paths } from './openapi-paths';

const fetchClient = createOpenApiFetchClient<paths>({
  prefixUrl: 'https://api.example.com/v1'
});

const result = await fetchClient.get('/blogposts/{postId}', {
  pathParams: {
    postId: '123'
  }
});

// 2XX Response Codes
if (result.isOk()) {
  console.log(result.value.data);
}
// Error response or Network exception
else {
  console.log(result.error);
}

// Or get OK response and throw error
result.unwrap();

await fetchClient.put('/blogposts/', { id: '123', message: 'hello' });
```

## Features

### `withRetry()`

Retries a request using an exponential backoff strategy for network exceptions (`NetworkException`) or HTTP `429` (Too Many Requests) responses.

```ts
import { createApiFetchClient, withRetry } from 'feature-fetch';

const fetchClient = withRetry(createApiFetchClient({
  prefixUrl: 'https://api.example.com/v1'
}), {
  maxRetries: 3
});
```

- **`maxRetries`**: Maximum number of retry attempts

### `withDelay()`

Delays a request by a specified number of milliseconds before sending it.

```ts
import { createApiFetchClient, withDelay } from 'feature-fetch';

const fetchClient = withDelay(createApiFetchClient({
  prefixUrl: 'https://api.example.com/v1'
}), 1000);
```

- **`delayInMs`**: Delay duration in milliseconds