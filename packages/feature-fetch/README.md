# `feature-fetch`
> Status: Experimental

A straightforward, typesafe, and feature-based [`fetch`](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) wrapper.

- **Lightweight & Tree Shakable**: Function-based and modular design (< 6KB minified)
- **Fast**: Thin wrapper around the native fetch, maintaining near-native performance
- **Modular & Expandable**: Easily extendable with features like `withRetry()`, `withOpenApi()`, ..
- **Typesafe**: Build in TypeScript with support for `openapi-typescript` types
- **Standalone**: Only dependent on `fetch`, ensuring ease of use in various environments

### Motivation

Provide a typesafe, straightforward, and lightweight `fetch` wrapper that seamlessly integrates with OpenAPI schemas using `openapi-typescript`. It aims to simplify error handling by returning results in a predictable manner with [`ts-results-es`](https://github.com/lune-climate/ts-results-es#readme). Additionally, it is designed to be modular & expandable, enabling the creation of straightforward API wrappers, such as for the Google Web Fonts API (see [`google-webfonts-client`](https://github.com/inbeta-group/monorepo/tree/develop/packages/google-webfonts-client)), with simple and intuitive functions. `feature-fetch` only depends on `fetch`, making it usable in sandboxed environments like Figma plugins.

### Alternatives

- [wretch](https://github.com/elbywan/wretch)
- [openapi-fetch](https://github.com/drwpow/openapi-typescript/tree/main/packages/openapi-fetch)

# ðŸ“– Usage

## `withApi()`

Use `feature-fetch` as a typesafe `fetch` wrapper with the common `get`, `post`, `put`, `del` methods.

```ts
import { createApiFetchClient } from 'feature-fetch';

const fetchClient = createApiFetchClient({
  prefixUrl: 'https://api.example.com/v1'
});

// Send request
const result = await fetchClient.get<{ id: string }>('/blogposts/{postId}', {
  pathParams: {
    postId: '123'
  }
});

// Handle response

// 2XX Response Codes
if (result.isOk()) {
  console.log(result.value.data);
}
// Error response or Network exception
else {
  console.log(result.error); // typeof NetworkException | RequestException | ServiceException
}

// Or get OK response and throw 'result.error' as an exception
result.unwrap();
```

## `withOpenApi()`

Use `feature-fetch` as a typesafe `fetch` wrapper with the common `get`, `post`, `put`, `del` methods that pull in your OpenAPI schema using [`openapi-typescript`](https://github.com/drwpow/openapi-typescript/tree/main) and make it nearly impossible to send wrong requests.

```ts
import { createOpenApiFetchClient } from 'feature-fetch';
// Generated by 'openapi-typescript'
import { paths } from './openapi-paths';

const fetchClient = createOpenApiFetchClient<paths>({
  prefixUrl: 'https://api.example.com/v1'
});

// Send request
const result = await fetchClient.get('/blogposts/{postId}', {
  pathParams: {
    postId: '123'
  }
});

// Handle response

// 2XX Response Codes
if (result.isOk()) {
  console.log(result.value.data);
}
// Error response or Network exception
else {
  console.log(result.error); // typeof NetworkException | RequestException | ServiceException
}

// Or get OK response and throw 'result.error' as an exception
result.unwrap();
```

## Features

### `withRetry()`

Retries each request using an exponential backoff strategy if a network exceptions (`NetworkException`) or HTTP `429` (Too Many Requests) response occur.

```ts
import { createApiFetchClient, withRetry } from 'feature-fetch';

const fetchClient = withRetry(createApiFetchClient({
  prefixUrl: 'https://api.example.com/v1'
}), {
  maxRetries: 3
});
```

- **`maxRetries`**: Maximum number of retry attempts

### `withDelay()`

Delays each request by a specified number of milliseconds before sending it.

```ts
import { createApiFetchClient, withDelay } from 'feature-fetch';

const fetchClient = withDelay(createApiFetchClient({
  prefixUrl: 'https://api.example.com/v1'
}), 1000);
```

- **`delayInMs`**: Delay duration in milliseconds